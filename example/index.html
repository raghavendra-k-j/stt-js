<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>STT Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 text-gray-800">
    <div class="max-w-xl mx-auto p-6">
      <h1 class="text-2xl font-bold mb-4">ğŸ™ï¸ Speech Recognition</h1>

      <button
        id="startBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"
      >
        ğŸ™ï¸ Speak
      </button>

      <textarea
        id="output"
        readonly
        placeholder="Speech will appear here..."
        class="w-full mt-4 h-56 p-2 border rounded resize-none"
      ></textarea>
    </div>

    <script type="module">
      import { STT } from "../dist/STT.bundle.js";

      const stt = new STT();
      const startBtn = document.getElementById("startBtn");
      const output = document.getElementById("output");

      let fullText = "";
      let recognizing = false;

      stt.addListener("start", () => {
        startBtn.textContent = "ğŸ›‘ Stop";
      });

      stt.addListener("end", () => {
        startBtn.textContent = "ğŸ™ï¸ Speak";
      });

      stt.addListener("result", (finalTranscript) => {
        fullText = finalTranscript;
        output.value = fullText;
      });

      stt.addListener("partialResult", (interimTranscript) => {
        if (fullText.length > 0) {
          output.value = fullText + " " + interimTranscript;
        } else {
          output.value = interimTranscript;
        }
      });

      stt.addListener("error", (error) => {
        alert("STT Error: " + error.message);
        recognizing = false;
        startBtn.textContent = "ğŸ™ï¸ Speak";
      });

      startBtn.onclick = async () => {
        if (!recognizing) {
          try {
            await stt.start(); // uses default options
            recognizing = true;
          } catch (e) {
            alert("Error: " + e.message);
          }
        } else {
          stt.stop();
          recognizing = false;
        }
      };
    </script>
  </body>
</html>
